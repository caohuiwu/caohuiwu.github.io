---
title: 记一次MYSQL服务器CPU爆了问题
date: 2019-01-10 15:32:50
tags: MySQL
categories: MySQL
---
# 一、背景
数据库CPU爆满，负载高。
![redis-io](2019-01-10-记一次MYSQL服务器CPU爆了问题/mysql.png)

<!--more-->    

# 二、查看具体问题SQL
![redis-io](2019-01-10-记一次MYSQL服务器CPU爆了问题/err-sql.png)

# 三、使用EXPLAIN解析SQL
```
EXPLAIN select * from sys_user
left join sys_office on sys_user.office_id = sys_office.id
where  sys_office.del_flag = 0 and (sys_office.id=14691547965585801 or sys_office.parent_ids like '%,14691547965585801,%')
order by sys_user.id ASC limit 20000,100;
```
![redis-io](2019-01-10-记一次MYSQL服务器CPU爆了问题/err-sql-explain.png)

# 四、优化方案
```
EXPLAIN select sys_user.id from sys_user
left join sys_office on sys_user.office_id = sys_office.id
where  sys_office.del_flag = 0 and (sys_office.id=14691547965585801 or sys_office.parent_ids like '0,1,14691547965585801,%')
order by sys_user.id ASC limit 20000,100;
```
![redis-io](2019-01-10-记一次MYSQL服务器CPU爆了问题/new-sql-explain.png)
注意上图红框所示，用户表直接通过索引获取用户主键：解读MySQL执行计划的type列和extra列
![redis-io](2019-01-10-记一次MYSQL服务器CPU爆了问题/new-sql-cos-time.png)
新SQL耗时

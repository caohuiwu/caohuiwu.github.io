---
title: 《分布式》理论
date: 2021-08-11
categories:
  - [ 分布式系统 ]
---


<style>
.my-code {
   color: red;
}
.orange {
   color: orange
}
.red {
   color: red
}
code {
   color: #0ABF5B;
}
</style>

# 一、分布式系统
分布式系统，是由多台计算机通过网络互联组成的系统，各节点通过消息传递协作完成任务。

<!--more-->

**核心特点**：
- **分布性**：节点物流上分散，逻辑上协同工作。
- **对等性**：节点地位平等，无中心控制。
- **并发性**：多个节点并行处理任务。
- **无全局时钟**：节点间时间无法严格同步。
- **故障常态性**：节点或网络故障随时可能发生。

# 二、分布式系统遇到的问题
- 通信异常
- 网络分区
- 节点故障
- 三态
  - 每一次请求与响应存在特有的“三态”概念，即成功、失败和超时

# 三、衡量分布式系统的指标
- **性能**
  - 系统的**吞吐能力**，指系统在某一时间可以处理的数据总量，通常可以用`QPS`（每秒查询次数）或`TPS`（每秒事务次数）表示；
  - 系统的**响应延迟**，指系统完成某一功能需要使用的时间；
  - 系统的**并发能力**，指系统**同时处理的请求数量**或**用户数**。
  - _吞吐量 ≈ 并发量/平均响应时间_
    - 举例：若系统支持1000并发用户，每个请求平均耗时0.1秒，则`吞吐量 = 1000/0.1 = 10000QPS`
  - 上述三个性能指标往往会相互制约，追求高吞吐的系统，往往很难做到低延迟；系统平均响应时间较长时，也很难提高QPS。
- **可用性**
系统的可用性(`availability`)指系统在面对各种异常时可以正确提供服务的能力。系统的可用性可以用系统停服务的时间与正常服务的时间的比例来衡量，也可以用某功能的失败次数与成功次数的比例来衡量。可用性是分布式的重要指标，衡量了系统的鲁棒性，是系统容错能力的体现。
- **可扩展性**
系统的可扩展性(`scalability`)指分布式系统通过扩展集群机器规模提高系统性能（吞吐、延迟、并发）、存储容量、计算能力的特性。好的分布式系统总在追求“线性扩展性”，也就是使得系统的某一指标可以随着集群中的机器数量线性增长。
- **一致性**
分布式系统为了提高可用性，总是不可避免的使用副本的机制，从而引发副本一致性的问题。越是强的一致的性模型，对于用户使用来说使用起来越简单。


# 四、分布式理论
**分布式理论**是解决在分布式系统中面临的复杂问题的**核心方法论**，其核心目标是通过协调多个独立节点的协作，实现高效、可靠、可扩展的系统设计。

常见的分布式理论：
- **CAP理论**
- **BASE理论**

## 4.1、CAP理论
理论含义：这个定理里描述了一个分布式的系统中，涉及共享数据问题时，以下三个特性最多只能同时满足其中两个：
- **C（一致性）**
分布式系统当中的一致性指的是所有节点的数据一致，或者说是所有副本的数据一致
- **A （可用性）**
`Reads and writes always succeed`. 也就是说系统一直可用，而且服务一直保持正常
- **P （分区容错性）**
指系统在网络分区的情况下仍然能够正常工作

<code class="red">因为网络通信的不确定性可能导致分区容错，也就是分区容错性必然是存在的，因此我们只能在一致性和可用性之间做选择</code>：`CP or AP`
- `CP`：一致性&分区容错性，牺牲部分可用性，确保数据强一致（如分布式数据库）
- `AP`：可用性&分区容错性，接受最终一致性，优先保证服务可用。

## 4.2、BASE理论
`BASE`是对`CAP`中一致性和可用性权衡的结果，基于CAP定律逐步演化而来。其核心思想是*即使无法做到强一致性*，但每个应用都可以根据自身业务特点，才用适当的方式来使系统达到**最终一致性**。

**BASE理论**是`Basically Available`(基本可用)，`Soft State`（软状态）和`Eventually Consistent`（最终一致性）三个短语的缩写。

- `Basically Available` （基本可用）
  - 在分布式系统出现故障的时候，允许损失部分可用性，保证核心功能或者关键服务可用
    - 举例：比如一个电商网站，在购物高峰期间，系统可能会因为负载过高而响应变慢，但仍然能够保证用户可以浏览商品和下单等核心功能。或者在数据库进行维护时，部分用户可能无法访问历史订单，但新的订单仍然可以正常处理。
    - 实现方式：服务降级
- `Soft state`（软状态）
允许系统中的数据存在中间状态，这个状态不影响系统的可用性，并且可以在一段时间后达到一致状态。
- `Eventually consistent`（最终一致性）
系统中的所有数据副本在经过一段时间的同步后，最终能够达到一致的状态

## 4.3、BASE 理论与 CAP 定理的关系
- BASE 理论是对 CAP 定理的一种妥协
- BASE 理论通过放弃强一致性，采用最终一致性的方式，来换取系统的高可用性。
例如，在一个分布式存储系统中，如果采用强一致性的策略，那么在网络分区的情况下，可能会为了保证数据的一致性而暂停部分节点的服务，从而降低了系统的可用性。而如果采用 BASE 理论，系统可以在网络分区的情况下，允许部分节点的数据处于不一致的状态，继续为用户提供服务，然后通过异步的同步机制来逐步达到最终的一致性。


# 五、分布式系统更具体一些问题
- 分布式事务
- 分布式锁
